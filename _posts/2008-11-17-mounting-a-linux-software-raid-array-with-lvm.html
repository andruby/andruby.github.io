---
layout: post
title: Mounting a Linux software raid array with lvm
tags:
- technology
status: publish
type: post
published: true
meta: {}
---
I recently had a hard drive crash on my home Linux <a href="http://en.wikipedia.org/wiki/Network-attached_storage" title="Network-attached storage - Wikipedia" target="_blank">NAS</a> box. The important files were on a software raid 5 array, but the root filesystem (with the majority of the OS) were on a separate IDE hard drive.Only the IDE drive crashed so my important files were safe, but I needed to remount the raid array. It took me quite a while before I got that right, so I'll share my knowledge here for you. Here are the commands needed to reconstruct / remount a raid array with a Gentoo live cd:<!--more-->load the raid module and lvm driver if you need to:<code># modprobe raid5# modprobe dm-mod</code><h4>Find the UUID's of the devices</h4>( you can skip this step if you have a backup of your /etc/mdadm.conf file )<code># mdadm --examine --scan /dev/sda1</code>Where /dev/sda1 points to one of the partitions used for the raid array. The output looks like this on my box:<code>ARRAY /dev/md1 level=raid5 num-devices=4 UUID=94366f38:ccdadda0:06f85cb1:f1263d52</code>copy it to /etc/mdadm.conf<code># mdadm --examine --scan /dev/sda1 &gt;&gt; /etc/mdadm.conf</code>Now we need to add a list of devices to mdadm.conf of where to look for member disks:<br />(manually add this to mdadm.conf, the devices i had to add where /dev/sda1 to /dev/sdd1)<code>DEVICE /dev/sd[abcd]1</code>At the end that leaves us with this in our mdadm.conf file:<code>DEVICE /dev/sd[abcd]1ARRAY /dev/md1 level=raid5 num-devices=4 UUID=94366f38:ccdadda0:06f85cb1:f1263d52</code><h4>Assemble the raid array</h4>We make the mirror device node:<code># mknod /dev/md1 b 9 1</code>Assemble the array:<code># mdadm --assemble --scan </code>You can check /proc/mdstat to see if the array is online:<code># cat /proc/mdstatPersonalities : [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]md1 : active raid5 sda1[0] sdd1[3] sdc1[2] sdb1[1]      937705728 blocks level 5, 64k chunk, algorithm 2 [4/4] [UUUU]</code><h4>Activate the logical volumes</h4><code># vgscan</code>Scans your disk and should show you the Volume Group that was on the raid array and add it to the lvm database<code># vgchange -ay</code>This should activate the volumes and auto create the nodes in /dev<h4>Mount the filesystems</h4>I just needed to mount the filesystems just like I would mount a regular one:<code>mount --type ext3 /dev/vg2/var /mnt/gentoo/var</code>Hope this helps someone!
